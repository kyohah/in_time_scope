# Type definitions for InTimeScope gem

module InTimeScope
  VERSION: String

  # Base error class for InTimeScope errors
  class Error < StandardError
  end

  # Raised when a specified column does not exist on the table
  class ColumnNotFoundError < Error
  end

  # Raised when the scope configuration is invalid
  class ConfigurationError < Error
  end

  def self.included: (Class model) -> void

  # Configuration options for start_at column
  type start_at_config = {
    ?column: Symbol?,
    ?null: bool
  }

  # Configuration options for end_at column
  type end_at_config = {
    ?column: Symbol?,
    ?null: bool
  }

  # Class methods added to ActiveRecord models when InTimeScope is included
  module ClassMethods
    # Defines time-window scopes for the model
    #
    # @param scope_name [Symbol] The name of the scope (default: :in_time)
    # @param start_at [Hash] Configuration for the start column
    # @param end_at [Hash] Configuration for the end column
    # @return [void]
    # @raise [ColumnNotFoundError] When a specified column doesn't exist
    # @raise [ConfigurationError] When the configuration is invalid (at scope call time)
    def in_time_scope: (
      ?Symbol scope_name,
      ?start_at: start_at_config,
      ?end_at: end_at_config
    ) -> void

    private

    # Private implementation methods
    # These use ActiveRecord internals and are typed as untyped for flexibility
    def fetch_null_option: (untyped config, untyped column, untyped table_column_hash) -> untyped
    def define_scope_methods: (String suffix, start_at_column: untyped, start_at_null: untyped, end_at_column: untyped, end_at_null: untyped) -> void
    def define_error_scope_and_method: (String suffix, String message) -> void
    def define_start_only_scope: (String suffix, Symbol column) -> void
    def define_latest_one_scope: (String suffix, Symbol column) -> void
    def define_earliest_one_scope: (String suffix, Symbol column) -> void
    def define_end_only_scope: (String suffix, Symbol column) -> void
    def define_full_scope: (String suffix, Symbol start_column, untyped start_null, Symbol end_column, untyped end_null) -> void
    def define_instance_method: (String suffix, Symbol? start_column, untyped start_null, Symbol? end_column, untyped end_null) -> void
    def define_before_scope: (String suffix, Symbol? start_column, untyped start_null) -> void
    def define_after_scope: (String suffix, Symbol? end_column, untyped end_null) -> void
    def define_out_of_time_scope: (String suffix) -> void
  end
end

# Generated scope methods (dynamically defined)
# When you call `in_time_scope` on a model, it creates these methods:
#
# Class methods (primary - records in time window):
#   Model.in_time(time = Time.current) -> ActiveRecord::Relation
#   Model.in_time_<name>(time = Time.current) -> ActiveRecord::Relation  (for named scopes)
#   Model.latest_in_time(foreign_key, time = Time.current) -> ActiveRecord::Relation  (start-only/end-only)
#   Model.earliest_in_time(foreign_key, time = Time.current) -> ActiveRecord::Relation (start-only/end-only)
#
# Class methods (inverse - records outside time window):
#   Model.before_in_time(time = Time.current) -> ActiveRecord::Relation  (not yet started)
#   Model.after_in_time(time = Time.current) -> ActiveRecord::Relation   (already ended)
#   Model.out_of_time(time = Time.current) -> ActiveRecord::Relation     (before OR after)
#
# Instance methods (primary):
#   model.in_time?(time = Time.current) -> bool
#   model.in_time_<name>?(time = Time.current) -> bool  (for named scopes)
#
# Instance methods (inverse):
#   model.before_in_time?(time = Time.current) -> bool
#   model.after_in_time?(time = Time.current) -> bool
#   model.out_of_time?(time = Time.current) -> bool

# Extend ActiveRecord::Base to include InTimeScope
class ActiveRecord::Base
  extend InTimeScope::ClassMethods
end
